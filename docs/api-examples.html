<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Scripts | Agent CLI Docs</title>
    <link rel="stylesheet" href="./assets/docs.css" />
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">Agent CLI Docs</div>
        <p class="hint">Minimal + professional terminal agent</p>
        <nav class="nav"><a class="" href="./index.html">Get Started</a>
<a class="active" href="./api-examples.html">Scripts</a>
<a class="" href="./config-reference.html">Config</a></nav>
      </aside>
      <main class="main">
        <div class="topbar">
          <div>
            <h1 class="title">Scripts</h1>
            <p class="subtitle">Documentation in a modern docs layout for CLI workflows.</p>
          </div>
          <div class="controls">
            <button id="nav-toggle" class="mobile-toggle">Menu</button>
            <button id="theme-toggle">Toggle Theme</button>
            <select id="lang-switch" class="lang-select" aria-label="Select language">
              <option value="./api-examples.html" selected>ðŸ‡ºðŸ‡¸ English</option>
<option value="./de/api-examples.html">ðŸ‡©ðŸ‡ª Deutsch</option>
            </select>
          </div>
        </div>
        <article class="article">
<h1 id="script-and-ci-examples">Script and CI Examples</h1>
<p>Use these examples to integrate agent-cli into automation workflows, CI pipelines, and scripts.</p>
<h2 id="rules-for-automation">Rules for Automation</h2>
<ul><li>Always use <code>--json</code> for parseable output</li><li>Use <code>--approval auto</code> or <code>--approval never</code> (never <code>--approval ask</code>)</li><li>Check the <code>ok</code> field in JSON output for success/failure</li><li>Check the <code>code</code> field for specific error handling</li></ul>
<h2 id="bash">Bash</h2>
<h3 id="basic-usage">Basic Usage</h3>
<pre><code class="language-bash">set -euo pipefail

OUT=$(node agent.js -m &quot;Run tests and summarize&quot; --json --approval auto --mode build)
echo &quot;$OUT&quot;</code></pre>
<h3 id="parse-json-response">Parse JSON Response</h3>
<pre><code class="language-bash">set -euo pipefail

OUT=$(node agent.js -m &quot;Run npm test&quot; --json --approval auto --mode build)
OK=$(echo &quot;$OUT&quot; | jq -r &#39;.ok&#39;)
MESSAGE=$(echo &quot;$OUT&quot; | jq -r &#39;.message&#39;)

if [ &quot;$OK&quot; = &quot;true&quot; ]; then
  echo &quot;Agent succeeded: $MESSAGE&quot;
else
  ERROR=$(echo &quot;$OUT&quot; | jq -r &#39;.error&#39;)
  echo &quot;Agent failed: $ERROR&quot;
  exit 1
fi</code></pre>
<h3 id="attach-files-for-review">Attach Files for Review</h3>
<pre><code class="language-bash">OUT=$(node agent.js \
  -m &quot;Review this file for security issues&quot; \
  --file src/auth.js \
  --json \
  --approval auto \
  --tools off)
echo &quot;$OUT&quot; | jq -r &#39;.message&#39;</code></pre>
<h3 id="multi-file-context">Multi-File Context</h3>
<pre><code class="language-bash">OUT=$(node agent.js \
  -m &quot;Compare these implementations and suggest improvements&quot; \
  --file src/old-handler.js \
  --file src/new-handler.js \
  --json \
  --approval never)
echo &quot;$OUT&quot; | jq -r &#39;.message&#39;</code></pre>
<h3 id="ci-pipeline-check">CI Pipeline Check</h3>
<pre><code class="language-bash">set -euo pipefail

RESULT=$(node agent.js \
  -m &quot;Run lint and tests. Report pass or fail.&quot; \
  --json \
  --approval auto \
  --mode build)

OK=$(echo &quot;$RESULT&quot; | jq -r &#39;.ok&#39;)
TOOLS_USED=$(echo &quot;$RESULT&quot; | jq &#39;.toolCalls | length&#39;)
TIMING=$(echo &quot;$RESULT&quot; | jq -r &#39;.timingMs&#39;)

echo &quot;Status: ok=$OK, tools=$TOOLS_USED, time=${TIMING}ms&quot;

if [ &quot;$OK&quot; != &quot;true&quot; ]; then
  echo &quot;$RESULT&quot; | jq -r &#39;.error // .message&#39;
  exit 1
fi</code></pre>
<h2 id="powershell">PowerShell</h2>
<h3 id="basic-usage">Basic Usage</h3>
<pre><code class="language-powershell">$out = node agent.js -m &quot;Run tests and summarize&quot; --json --approval auto --mode build
$obj = $out | ConvertFrom-Json

if ($obj.ok) {
    Write-Host &quot;Success: $($obj.message)&quot;
} else {
    Write-Error &quot;Failed: $($obj.error)&quot;
    exit 1
}</code></pre>
<h3 id="with-file-attachment">With File Attachment</h3>
<pre><code class="language-powershell">$out = node agent.js -m &quot;Review this config&quot; --file config/app.json --json --approval auto --tools off
$obj = $out | ConvertFrom-Json
Write-Host $obj.message</code></pre>
<h2 id="nodejs-child-process">Node.js Child Process</h2>
<h3 id="synchronous">Synchronous</h3>
<pre><code class="language-js">const { execFileSync } = require(&quot;node:child_process&quot;);

const raw = execFileSync(&quot;node&quot;, [
  &quot;agent.js&quot;,
  &quot;-m&quot;, &quot;Run lint and summarize&quot;,
  &quot;--json&quot;,
  &quot;--approval&quot;, &quot;auto&quot;,
  &quot;--mode&quot;, &quot;build&quot;,
], { encoding: &quot;utf8&quot; });

const result = JSON.parse(raw);
console.log(&quot;ok:&quot;, result.ok);
console.log(&quot;message:&quot;, result.message);
console.log(&quot;tool calls:&quot;, result.toolCalls.length);</code></pre>
<h3 id="asynchronous">Asynchronous</h3>
<pre><code class="language-js">const { execFile } = require(&quot;node:child_process&quot;);
const { promisify } = require(&quot;node:util&quot;);
const execFileAsync = promisify(execFile);

async function runAgent(message, options = {}) {
  const args = [
    &quot;agent.js&quot;,
    &quot;-m&quot;, message,
    &quot;--json&quot;,
    &quot;--approval&quot;, options.approval || &quot;auto&quot;,
    &quot;--mode&quot;, options.mode || &quot;build&quot;,
  ];

  if (options.model) {
    args.push(&quot;--model&quot;, options.model);
  }

  if (options.file) {
    args.push(&quot;--file&quot;, options.file);
  }

  const { stdout } = await execFileAsync(&quot;node&quot;, args, {
    encoding: &quot;utf8&quot;,
    timeout: 30000,
  });

  return JSON.parse(stdout);
}

// Usage
const result = await runAgent(&quot;Run tests&quot;, { mode: &quot;build&quot; });
console.log(result.ok, result.message);</code></pre>
<h2 id="python-subprocess">Python Subprocess</h2>
<pre><code class="language-python">import json
import subprocess

result = subprocess.run(
    [&quot;node&quot;, &quot;agent.js&quot;, &quot;-m&quot;, &quot;Run tests&quot;, &quot;--json&quot;, &quot;--approval&quot;, &quot;auto&quot;],
    capture_output=True,
    text=True,
    timeout=30,
)

data = json.loads(result.stdout)
if data[&quot;ok&quot;]:
    print(&quot;Success:&quot;, data[&quot;message&quot;])
else:
    print(&quot;Error:&quot;, data.get(&quot;error&quot;, &quot;unknown&quot;))</code></pre>
<h2 id="json-output-contract">JSON Output Contract</h2>
<h3 id="success-response">Success Response</h3>
<pre><code class="language-json">{
  &quot;ok&quot;: true,
  &quot;provider&quot;: &quot;copilot&quot;,
  &quot;model&quot;: &quot;copilot/gpt-4o&quot;,
  &quot;mode&quot;: &quot;build&quot;,
  &quot;approvalMode&quot;: &quot;auto&quot;,
  &quot;toolsMode&quot;: &quot;auto&quot;,
  &quot;toolsEnabled&quot;: true,
  &quot;toolsFallbackUsed&quot;: false,
  &quot;attachments&quot;: {
    &quot;files&quot;: [],
    &quot;images&quot;: []
  },
  &quot;message&quot;: &quot;All 42 tests passed successfully.&quot;,
  &quot;toolCalls&quot;: [
    {
      &quot;name&quot;: &quot;run_command&quot;,
      &quot;args&quot;: { &quot;cmd&quot;: &quot;npm test&quot; },
      &quot;result&quot;: { &quot;ok&quot;: true, &quot;cmd&quot;: &quot;npm test&quot;, &quot;stdout&quot;: &quot;...&quot;, &quot;stderr&quot;: &quot;&quot; }
    }
  ],
  &quot;timingMs&quot;: 3200
}</code></pre>
<h3 id="error-response">Error Response</h3>
<pre><code class="language-json">{
  &quot;ok&quot;: false,
  &quot;error&quot;: &quot;Provider &#39;openai&#39; is not configured. Setup: node agent-connect.js --provider openai&quot;,
  &quot;code&quot;: &quot;PROVIDER_NOT_CONFIGURED&quot;
}</code></pre>
<h3 id="blocked-command-in-tool-call">Blocked Command in Tool Call</h3>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;run_command&quot;,
  &quot;args&quot;: { &quot;cmd&quot;: &quot;rm -rf /&quot; },
  &quot;result&quot;: {
    &quot;ok&quot;: false,
    &quot;blocked&quot;: true,
    &quot;mode&quot;: &quot;build&quot;,
    &quot;policy&quot;: { &quot;source&quot;: &quot;denyCritical&quot;, &quot;rule&quot;: &quot;rm -rf /&quot; },
    &quot;error&quot;: &quot;BLOCKED: Command not allowed in mode &#39;build&#39;: rm -rf /&quot;
  }
}</code></pre>
<h3 id="fields-reference">Fields Reference</h3>
<ul><li><code>ok</code> (<code>boolean</code>) -- Whether the request completed successfully</li><li><code>provider</code> (<code>string</code>) -- Provider used for the request</li><li><code>model</code> (<code>string</code>) -- Full model identifier (<code>provider/model</code>)</li><li><code>mode</code> (<code>string</code>) -- Security mode that was active</li><li><code>approvalMode</code> (<code>string</code>) -- Approval mode that was active</li><li><code>toolsMode</code> (<code>string</code>) -- Tools mode that was configured</li><li><code>toolsEnabled</code> (<code>boolean</code>) -- Whether tools were actually sent to the model</li><li><code>toolsFallbackUsed</code> (<code>boolean</code>) -- Whether auto-mode fell back to no-tools</li><li><code>attachments</code> (<code>object</code>) -- Files and images that were attached</li><li><code>message</code> (<code>string</code>) -- Final text response from the AI</li><li><code>toolCalls</code> (<code>array</code>) -- All tool calls made during the session</li><li><code>timingMs</code> (<code>number</code>) -- Total execution time in milliseconds</li><li><code>error</code> (<code>string</code>) -- Error message (only when <code>ok</code> is false)</li><li><code>code</code> (<code>string</code>) -- Error code (only when <code>ok</code> is false)</li></ul>
<h2 id="exit-codes">Exit Codes</h2>
<ul><li><code>0</code> -- Successful execution</li><li>Non-zero -- Error or blocked operation</li></ul>
<p>For deterministic automation, always parse the JSON <code>ok</code> and <code>code</code> fields rather than relying on exit codes alone.</p>
        </article>
      </main>
      <aside class="right">
        <div class="toc-title">On This Page</div>
        <nav class="toc"><a href="#rules-for-automation">Rules for Automation</a>
<a href="#bash">Bash</a>
<a style="padding-left:12px" href="#basic-usage">Basic Usage</a>
<a style="padding-left:12px" href="#parse-json-response">Parse JSON Response</a>
<a style="padding-left:12px" href="#attach-files-for-review">Attach Files for Review</a>
<a style="padding-left:12px" href="#multi-file-context">Multi-File Context</a>
<a style="padding-left:12px" href="#ci-pipeline-check">CI Pipeline Check</a>
<a href="#powershell">PowerShell</a>
<a style="padding-left:12px" href="#basic-usage">Basic Usage</a>
<a style="padding-left:12px" href="#with-file-attachment">With File Attachment</a>
<a href="#nodejs-child-process">Node.js Child Process</a>
<a style="padding-left:12px" href="#synchronous">Synchronous</a>
<a style="padding-left:12px" href="#asynchronous">Asynchronous</a>
<a href="#python-subprocess">Python Subprocess</a>
<a href="#json-output-contract">JSON Output Contract</a>
<a style="padding-left:12px" href="#success-response">Success Response</a>
<a style="padding-left:12px" href="#error-response">Error Response</a>
<a style="padding-left:12px" href="#blocked-command-in-tool-call">Blocked Command in Tool Call</a>
<a style="padding-left:12px" href="#fields-reference">Fields Reference</a>
<a href="#exit-codes">Exit Codes</a></nav>
      </aside>
    </div>
    <script src="./assets/docs.js"></script>
  </body>
</html>