<!doctype html>
<html lang="de" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Skripte | Agent CLI Docs</title>
    <link rel="stylesheet" href="../assets/docs.css" />
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">Agent CLI Docs</div>
        <p class="hint">Minimal + professional terminal agent</p>
        <nav class="nav"><a class="" href="./index.html">Einstieg</a>
<a class="active" href="./api-examples.html">Skripte</a>
<a class="" href="./json-contract.html">JSON-Vertrag</a>
<a class="" href="./config-reference.html">Konfiguration</a></nav>
      </aside>
      <main class="main">
        <div class="topbar">
          <div>
            <h1 class="title">Skripte</h1>
            <p class="subtitle">Dokumentation im modernen Layout fuer CLI-Workflows.</p>
          </div>
          <div class="controls">
            <button id="nav-toggle" class="mobile-toggle">Menu</button>
            <button id="theme-toggle" aria-label="Toggle Theme"><svg id="theme-icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg><svg id="theme-icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></button>
            <select id="lang-switch" class="lang-select" aria-label="Select language">
              <option value="../api-examples.html">ðŸ‡ºðŸ‡¸ English</option>
<option value="./api-examples.html" selected>ðŸ‡©ðŸ‡ª Deutsch</option>
            </select>
          </div>
        </div>
        <article class="article">
<h1 id="skript--und-ci-beispiele">Skript- und CI-Beispiele</h1>
<p>Diese Beispiele zeigen, wie du agent-cli in Automations-Workflows, CI-Pipelines und Skripte integrieren kannst.</p>
<h2 id="regeln-fuer-automation">Regeln fuer Automation</h2>
<ul><li>Immer <code>--json</code> fuer parsebaren Output verwenden</li><li><code>--approval auto</code> oder <code>--approval never</code> verwenden (nie <code>--approval ask</code>)</li><li>Das <code>ok</code>-Feld im JSON-Output fuer Erfolg/Fehler pruefen</li><li>Das <code>code</code>-Feld fuer spezifische Fehlerbehandlung pruefen</li></ul>
<h2 id="bash">Bash</h2>
<h3 id="grundlegende-nutzung">Grundlegende Nutzung</h3>
<pre><code class="language-bash">set -euo pipefail

OUT=$(node agent.js -m &quot;Tests ausfuehren und zusammenfassen&quot; --json --approval auto --profile dev)
echo &quot;$OUT&quot;</code></pre>
<h3 id="json-antwort-parsen">JSON-Antwort parsen</h3>
<pre><code class="language-bash">set -euo pipefail

OUT=$(node agent.js -m &quot;npm test ausfuehren&quot; --json --approval auto --profile dev)
OK=$(echo &quot;$OUT&quot; | jq -r &#39;.ok&#39;)
MESSAGE=$(echo &quot;$OUT&quot; | jq -r &#39;.message&#39;)

if [ &quot;$OK&quot; = &quot;true&quot; ]; then
  echo &quot;Agent erfolgreich: $MESSAGE&quot;
else
  ERROR=$(echo &quot;$OUT&quot; | jq -r &#39;.error&#39;)
  echo &quot;Agent fehlgeschlagen: $ERROR&quot;
  exit 1
fi</code></pre>
<h3 id="dateien-fuer-review-anhaengen">Dateien fuer Review anhaengen</h3>
<pre><code class="language-bash">OUT=$(node agent.js \
  -m &quot;Pruefe diese Datei auf Sicherheitsprobleme&quot; \
  --file src/auth.js \
  --json \
  --approval auto \
  --tools off)
echo &quot;$OUT&quot; | jq -r &#39;.message&#39;</code></pre>
<h3 id="multi-datei-kontext">Multi-Datei-Kontext</h3>
<pre><code class="language-bash">OUT=$(node agent.js \
  -m &quot;Vergleiche diese Implementierungen und schlage Verbesserungen vor&quot; \
  --file src/old-handler.js \
  --file src/new-handler.js \
  --json \
  --approval never)
echo &quot;$OUT&quot; | jq -r &#39;.message&#39;</code></pre>
<h3 id="ci-pipeline-check">CI-Pipeline Check</h3>
<pre><code class="language-bash">set -euo pipefail

RESULT=$(node agent.js \
  -m &quot;Lint und Tests ausfuehren. Pass oder Fail melden.&quot; \
  --json \
  --approval auto \
  --profile dev)

OK=$(echo &quot;$RESULT&quot; | jq -r &#39;.ok&#39;)
TOOLS_USED=$(echo &quot;$RESULT&quot; | jq &#39;.toolCalls | length&#39;)
TIMING=$(echo &quot;$RESULT&quot; | jq -r &#39;.timingMs&#39;)

echo &quot;Status: ok=$OK, tools=$TOOLS_USED, zeit=${TIMING}ms&quot;

if [ &quot;$OK&quot; != &quot;true&quot; ]; then
  echo &quot;$RESULT&quot; | jq -r &#39;.error // .message&#39;
  exit 1
fi</code></pre>
<h2 id="powershell">PowerShell</h2>
<h3 id="grundlegende-nutzung">Grundlegende Nutzung</h3>
<pre><code class="language-powershell">$out = node agent.js -m &quot;Tests ausfuehren und zusammenfassen&quot; --json --approval auto --profile dev
$obj = $out | ConvertFrom-Json

if ($obj.ok) {
    Write-Host &quot;Erfolg: $($obj.message)&quot;
} else {
    Write-Error &quot;Fehlgeschlagen: $($obj.error)&quot;
    exit 1
}</code></pre>
<h3 id="mit-datei-anhang">Mit Datei-Anhang</h3>
<pre><code class="language-powershell">$out = node agent.js -m &quot;Pruefe diese Config&quot; --file config/app.json --json --approval auto --tools off
$obj = $out | ConvertFrom-Json
Write-Host $obj.message</code></pre>
<h2 id="nodejs-child-process">Node.js Child Process</h2>
<h3 id="synchron">Synchron</h3>
<pre><code class="language-js">const { execFileSync } = require(&quot;node:child_process&quot;);

const raw = execFileSync(&quot;node&quot;, [
  &quot;agent.js&quot;,
  &quot;-m&quot;, &quot;Lint ausfuehren und zusammenfassen&quot;,
  &quot;--json&quot;,
  &quot;--approval&quot;, &quot;auto&quot;,
  &quot;--profile&quot;, &quot;dev&quot;,
], { encoding: &quot;utf8&quot; });

const result = JSON.parse(raw);
console.log(&quot;ok:&quot;, result.ok);
console.log(&quot;nachricht:&quot;, result.message);
console.log(&quot;tool calls:&quot;, result.toolCalls.length);</code></pre>
<h3 id="asynchron">Asynchron</h3>
<pre><code class="language-js">const { execFile } = require(&quot;node:child_process&quot;);
const { promisify } = require(&quot;node:util&quot;);
const execFileAsync = promisify(execFile);

async function runAgent(message, options = {}) {
  const args = [
    &quot;agent.js&quot;,
    &quot;-m&quot;, message,
    &quot;--json&quot;,
    &quot;--approval&quot;, options.approval || &quot;auto&quot;,
    &quot;--profile&quot;, options.profile || &quot;dev&quot;,
  ];

  if (options.model) {
    args.push(&quot;--model&quot;, options.model);
  }

  if (options.file) {
    args.push(&quot;--file&quot;, options.file);
  }

  const { stdout } = await execFileAsync(&quot;node&quot;, args, {
    encoding: &quot;utf8&quot;,
    timeout: 30000,
  });

  return JSON.parse(stdout);
}

// Verwendung
const result = await runAgent(&quot;Tests ausfuehren&quot;, { profile: &quot;dev&quot; });
console.log(result.ok, result.message);</code></pre>
<h2 id="python-subprocess">Python Subprocess</h2>
<pre><code class="language-python">import json
import subprocess

result = subprocess.run(
    [&quot;node&quot;, &quot;agent.js&quot;, &quot;-m&quot;, &quot;Tests ausfuehren&quot;, &quot;--json&quot;, &quot;--approval&quot;, &quot;auto&quot;],
    capture_output=True,
    text=True,
    timeout=30,
)

data = json.loads(result.stdout)
if data[&quot;ok&quot;]:
    print(&quot;Erfolg:&quot;, data[&quot;message&quot;])
else:
    print(&quot;Fehler:&quot;, data.get(&quot;error&quot;, &quot;unbekannt&quot;))</code></pre>
<h2 id="json-output-contract">JSON Output Contract</h2>
<h3 id="erfolgs-antwort">Erfolgs-Antwort</h3>
<pre><code class="language-json">{
  &quot;ok&quot;: true,
  &quot;provider&quot;: &quot;copilot&quot;,
  &quot;model&quot;: &quot;copilot/gpt-4o&quot;,
  &quot;profile&quot;: &quot;dev&quot;,
  &quot;mode&quot;: &quot;dev&quot;,
  &quot;approvalMode&quot;: &quot;auto&quot;,
  &quot;toolsMode&quot;: &quot;auto&quot;,
  &quot;toolsEnabled&quot;: true,
  &quot;toolsFallbackUsed&quot;: false,
  &quot;attachments&quot;: {
    &quot;files&quot;: [],
    &quot;images&quot;: []
  },
  &quot;usage&quot;: {
    &quot;turns&quot;: 2,
    &quot;turns_with_usage&quot;: 2,
    &quot;has_usage&quot;: true,
    &quot;input_tokens&quot;: 1200,
    &quot;output_tokens&quot;: 240,
    &quot;total_tokens&quot;: 1440
  },
  &quot;message&quot;: &quot;Alle 42 Tests erfolgreich bestanden.&quot;,
  &quot;toolCalls&quot;: [
    {
      &quot;tool&quot;: &quot;run_command&quot;,
      &quot;input&quot;: { &quot;cmd&quot;: &quot;npm test&quot; },
      &quot;ok&quot;: true,
      &quot;result&quot;: { &quot;ok&quot;: true, &quot;cmd&quot;: &quot;npm test&quot;, &quot;stdout&quot;: &quot;...&quot;, &quot;stderr&quot;: &quot;&quot; },
      &quot;error&quot;: null,
      &quot;meta&quot;: { &quot;duration_ms&quot;: 1180, &quot;ts&quot;: &quot;2026-02-15T12:00:00.000Z&quot; }
    }
  ],
  &quot;timingMs&quot;: 3200
}</code></pre>
<h3 id="fehler-antwort">Fehler-Antwort</h3>
<pre><code class="language-json">{
  &quot;ok&quot;: false,
  &quot;error&quot;: &quot;Provider &#39;openai&#39; is not configured. Setup: node agent-connect.js --provider openai&quot;,
  &quot;code&quot;: &quot;PROVIDER_NOT_CONFIGURED&quot;
}</code></pre>
<h3 id="blockierter-befehl-im-tool-call">Blockierter Befehl im Tool-Call</h3>
<pre><code class="language-json">{
  &quot;tool&quot;: &quot;run_command&quot;,
  &quot;input&quot;: { &quot;cmd&quot;: &quot;rm -rf /&quot; },
  &quot;ok&quot;: false,
  &quot;result&quot;: null,
  &quot;error&quot;: {
    &quot;message&quot;: &quot;BLOCKED: Command not allowed for profile &#39;dev&#39;: rm -rf /&quot;,
    &quot;code&quot;: &quot;TOOL_EXECUTION_ERROR&quot;
  },
  &quot;meta&quot;: { &quot;duration_ms&quot;: 3, &quot;ts&quot;: &quot;2026-02-15T12:00:01.000Z&quot; }
}</code></pre>
<h3 id="garantierte-vs-optionale-felder">Garantierte vs optionale Felder</h3>
<p>Garantiert in erfolgreichen <code>--json</code>-Antworten:</p>
<ul><li><code>ok</code></li><li><code>provider</code></li><li><code>model</code></li><li><code>profile</code></li><li><code>mode</code></li><li><code>approvalMode</code></li><li><code>toolsMode</code></li><li><code>toolsEnabled</code></li><li><code>toolsFallbackUsed</code></li><li><code>attachments</code></li><li><code>usage</code></li><li><code>message</code></li><li><code>toolCalls</code></li><li><code>timingMs</code></li></ul>
<p>Optional (nur wenn zutreffend vorhanden):</p>
<ul><li><code>error</code> und <code>code</code> -- In Top-Level-Fehlerantworten (<code>ok: false</code>) vorhanden.</li></ul>
<p>Fuer jeden <code>toolCalls[]</code>-Record:</p>
<ul><li>Garantiert: <code>tool</code>, <code>input</code>, <code>ok</code>, <code>result</code>, <code>error</code>, <code>meta</code></li><li>Optional innerhalb von <code>error</code>: <code>code</code> kann vom Tool kommen (Fallback auf <code>TOOL_EXECUTION_ERROR</code>).</li></ul>
<h3 id="tool-fehlercodes">Tool-Fehlercodes</h3>
<p>Hauefige Tool-Fehlercodes in normalisierten Tool-Call-Records:</p>
<p>| Code | Bedeutung | Typische Loesung | |------|-----------|------------------| | <code>TOOL_INVALID_ARGS</code> | Fehlende/ungueltige Tool-Argumente | Tool-Input-Payload validieren | | <code>TOOL_NOT_FOUND</code> | Datei/Pfad-Ziel nicht gefunden | Zielpfad pruefen | | <code>TOOL_INVALID_PATTERN</code> | Ungueltiges Regex-Pattern | Regex-Syntax korrigieren | | <code>TOOL_UNSUPPORTED_FILE_TYPE</code> | Binaer-aehnliche Datei in Text-Tool | Textdatei oder anderes Tool verwenden | | <code>TOOL_CONFLICT</code> | Ziel/Add-Ziel existiert bereits | Overwrite/Move oder anderes Ziel nutzen | | <code>TOOL_UNKNOWN</code> | Tool-Name ist nicht registriert | Unterstuetztes Tool verwenden | | <code>TOOL_EXECUTION_ERROR</code> | Allgemeiner Tool/Runtime-Fehler-Fallback | <code>error.message</code> fuer Details pruefen |</p>
<h3 id="felder-referenz">Felder-Referenz</h3>
<ul><li><code>ok</code> (<code>boolean</code>) -- Ob die Anfrage erfolgreich abgeschlossen wurde</li><li><code>provider</code> (<code>string</code>) -- Verwendeter Provider</li><li><code>model</code> (<code>string</code>) -- Vollstaendige Modell-Kennung (<code>provider/model</code>)</li><li><code>profile</code> (<code>string</code>) -- Effektives Runtime-Profil (<code>safe|dev|framework</code>)</li><li><code>mode</code> (<code>string</code>) -- Effektiver Policy-Key (gleicher Wert wie Profil: <code>safe|dev|framework</code>)</li><li><code>approvalMode</code> (<code>string</code>) -- Aktiver Freigabemodus</li><li><code>toolsMode</code> (<code>string</code>) -- Konfigurierter Tools-Modus</li><li><code>toolsEnabled</code> (<code>boolean</code>) -- Ob Tools tatsaechlich an das Modell gesendet wurden</li><li><code>toolsFallbackUsed</code> (<code>boolean</code>) -- Ob Auto-Modus auf ohne-Tools zurueckgefallen ist</li><li><code>attachments</code> (<code>object</code>) -- Angehaengte Dateien und Bilder</li><li><code>usage</code> (<code>object</code>) -- Aggregierte Usage fuer diesen Lauf (<code>turns</code>, <code>input_tokens</code>, <code>output_tokens</code>, <code>total_tokens</code>, ...)</li><li><code>message</code> (<code>string</code>) -- Finale Textantwort der KI</li><li><code>toolCalls</code> (<code>array</code>) -- Normalisierte Tool-Call-Records (<code>tool</code>, <code>input</code>, <code>ok</code>, <code>result</code>, <code>error</code>, <code>meta</code>)</li><li><code>timingMs</code> (<code>number</code>) -- Gesamte Ausfuehrungszeit in Millisekunden</li><li><code>error</code> (<code>string</code>) -- Fehlermeldung (nur wenn <code>ok</code> false ist)</li><li><code>code</code> (<code>string</code>) -- Fehlercode (nur wenn <code>ok</code> false ist)</li></ul>
<h2 id="exit-codes">Exit-Codes</h2>
<ul><li><code>0</code> -- Erfolgreiche Ausfuehrung</li><li>Ungleich null -- Fehler oder blockierte Operation</li></ul>
<p>Fuer deterministische Automation immer die JSON-Felder <code>ok</code> und <code>code</code> parsen, anstatt sich nur auf Exit-Codes zu verlassen.</p>
        </article>
      </main>
      <aside class="right">
        <div class="toc-title">On This Page</div>
        <nav class="toc"><a href="#regeln-fuer-automation">Regeln fuer Automation</a>
<a href="#bash">Bash</a>
<a class="sub-item" href="#grundlegende-nutzung">Grundlegende Nutzung</a>
<a class="sub-item" href="#json-antwort-parsen">JSON-Antwort parsen</a>
<a class="sub-item" href="#dateien-fuer-review-anhaengen">Dateien fuer Review anhaengen</a>
<a class="sub-item" href="#multi-datei-kontext">Multi-Datei-Kontext</a>
<a class="sub-item" href="#ci-pipeline-check">CI-Pipeline Check</a>
<a href="#powershell">PowerShell</a>
<a class="sub-item" href="#grundlegende-nutzung">Grundlegende Nutzung</a>
<a class="sub-item" href="#mit-datei-anhang">Mit Datei-Anhang</a>
<a href="#nodejs-child-process">Node.js Child Process</a>
<a class="sub-item" href="#synchron">Synchron</a>
<a class="sub-item" href="#asynchron">Asynchron</a>
<a href="#python-subprocess">Python Subprocess</a>
<a href="#json-output-contract">JSON Output Contract</a>
<a class="sub-item" href="#erfolgs-antwort">Erfolgs-Antwort</a>
<a class="sub-item" href="#fehler-antwort">Fehler-Antwort</a>
<a class="sub-item" href="#blockierter-befehl-im-tool-call">Blockierter Befehl im Tool-Call</a>
<a class="sub-item" href="#garantierte-vs-optionale-felder">Garantierte vs optionale Felder</a>
<a class="sub-item" href="#tool-fehlercodes">Tool-Fehlercodes</a>
<a class="sub-item" href="#felder-referenz">Felder-Referenz</a>
<a href="#exit-codes">Exit-Codes</a></nav>
      </aside>
    </div>
    <script src="../assets/docs.js"></script>
  </body>
</html>